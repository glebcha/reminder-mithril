"use strict";var reminder=reminder||{};reminder.Remind=function(e){this.description=m.prop(e.description),this.date=m.prop(e.date),this.edited=m.prop(e.edited),this.error=m.prop(e.error)},function(){var e="task-list";reminder.storage={get:function(){return JSON.parse(localStorage.getItem(e)||"[]")},set:function(t){localStorage.setItem(e,JSON.stringify(t))}}}(),reminder.controller=function(){this.list=reminder.storage.get(),this.list=this.list.map(function(e){return new reminder.Remind(e)}),this.description=m.prop(""),this.MAX_STRING_LENGTH=100,this.add=function(){this.description()&&this.description().replace(/\s/g,"").length<=this.MAX_STRING_LENGTH&&(this.list.push(new reminder.Remind({description:this.description(this.description().trim()),date:moment.utc().format(),edited:!1,error:!1})),reminder.storage.set(this.list),this.description(""))},this.edit=function(e,t){this.description()&&this.description().replace(/\s/g,"").length<=t.MAX_STRING_LENGTH?(this.description(this.description().trim()),this.date(moment.utc().format()),this.edited(!0),this.error(!1),reminder.storage.set(t.list)):(this.error(!0),this.description(reminder.storage.get()[e].description))}},reminder.view=function(){return function(e){return m("div.tasks-container",[m("h1","Напоминания"),m("input.add-remind[placeholder='Текст напоминания']",{autofocus:!0,onkeyup:function(t){13===t.keyCode?e.add():27===t.keyCode?e.description(""):m.redraw.strategy("none")},oninput:m.withAttr("value",e.description),value:e.description(),config:function(){var t=document.getElementById("input-status");t.innerHTML=e.description().replace(/\s/g,"").length<=e.MAX_STRING_LENGTH?"осталось "+(e.MAX_STRING_LENGTH-e.description().replace(/\s/g,"").length)+" символов":"<span class='danger'>превышен допустимый лимит в "+e.MAX_STRING_LENGTH+" символов</span>"}}),m("button.add",{onclick:e.add.bind(e)},"+"),m("div#input-status"),m("ul#todo-list",[e.list.map(function(t,i){return m("li",[m("label",{"data-date":t.date()},[m("div.description",{"data-edited":t.edited(),"data-error":t.error(),config:function(e){var t=e.parentNode.querySelector("textarea"),i=e.parentNode.querySelector(".inner-status");t.style.height=e.offsetHeight>0?e.offsetHeight+"px":"auto",e.addEventListener("dblclick",function(){t.className="show",i.className.match("show")||(i.className="inner-status show"),e.className.match("hide")||(e.className+=" hide"),t.focus()})}},t.description()),m("textarea.hide",{rows:1,oninput:m.withAttr("value",t.description),onkeyup:function(r){var s=reminder.storage.get()[i].description,n=this.parentNode.querySelector(".description"),a=this.parentNode.querySelector(".inner-status");13===r.keyCode?(e.edit.call(t,i,e),this.className="hide",n.className=n.className.replace("hide","").trim(),a.className=a.className.replace("show","").trim()):27===r.keyCode?(t.description(s),this.value=s,this.className="hide",n.className=n.className.replace("hide","").trim(),a.className=a.className.replace("show","").trim()):m.redraw.strategy("none")},onblur:function(){var e=reminder.storage.get()[i].description,r=this.parentNode.querySelector(".description"),s=this.parentNode.querySelector(".inner-status");t.description(e),this.value=e,this.className="hide",r.className=r.className.replace("hide","").trim(),s.className=s.className.replace("show","").trim()},config:function(i){var r=i.parentNode.querySelector(".inner-status");i.focus(),r.innerHTML=e.MAX_STRING_LENGTH-t.description().replace(/\s/g,"").length,i.style.minHeight=i.scrollHeight+"px",t.description().replace(/\s/g,"").length>=e.MAX_STRING_LENGTH&&!r.className.match("error")&&(r.className+=" error")}},t.description()),m("span.inner-status"),m("span.date",moment.utc(t.date()).fromNow())]),m("span.destroy",{onclick:function(){e.list.splice(i,1),reminder.storage.set(e.list)}})])})])])}}(),m.module(document.getElementById("reminderapp"),{controller:reminder.controller,view:reminder.view}),function(){var e=function(){var e=document.querySelectorAll("#todo-list>li>label");if(e.length>0)for(var t=0;t<e.length;t++){var i=e[t],r=i.getAttribute("data-date");i.querySelector(".date").innerText=moment.utc(r).fromNow()}};setInterval(e,5e3)}();